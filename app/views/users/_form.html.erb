<%= form_with(model: user, local: true) do |form| %>
  <% if user.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(user.errors.count, "error") %> prohibited this user from being saved:</h2>

      <ul>
        <% user.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-12">
      <fieldset>
        <legend>Login Information</legend>

        <div class="row">
          <div class="col-md-8 form-group">
            <%= form.label :email %>
            <%= form.text_field :email, class: "form-control" %>
            <% unless user.new_record? %>
              <small class="bg-info">
                ( Note that changes here are only applied after email confirmation )
              </small>
            <% end %>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 form-group">
            <%= form.label :timezone %>
            <%= form.time_zone_select :timezone, ActiveSupport::TimeZone.us_zones, { default: "Pacific Time (US & Canada)" }, {class: "form-control"} %>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 form-group">
            <%= form.label :password %>
            <%= form.password_field :password, class: "form-control" %>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 form-group">
            <%= form.label :password_confirmation %>
            <%= form.password_field :password_confirmation, class: "form-control" %>
          </div>
        </div>
      </fieldset>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <fieldset>
        <legend>Profile</legend>
        <%= form.fields_for :profile do |profile_form| %>
          <div class="row">
            <div class="col-md-2 form-group">
              <%= profile_form.label "Prefix" %>
              <%= profile_form.text_field :name_prefix, {class: "form-control"} %>
            </div>
            <div class="col-md-4 form-group">
              <%= profile_form.label "First Name" %>
              <%= profile_form.text_field :first_name, {class: "form-control"} %>
            </div>
            <div class="col-md-4 form-group">
              <%= profile_form.label "Last Name" %>
              <%= profile_form.text_field :last_name, {class: "form-control"} %>
            </div>
          </div>
          <div class="row">
            <div class="col-md-3 form-group">
              <%= profile_form.label :office_phone %>
              <%= profile_form.text_field :office_phone, {type: "tel", class: "form-control" } %>
            </div>
            <div class="col-md-3 form-group">
              <%= profile_form.label :cell_phone %>
              <%= profile_form.text_field :cell_phone, {type: "tel", class: "form-control" } %>
            </div>
            <div class="col-md-3 form-group">
              <%= profile_form.label :fax %>
              <%= profile_form.text_field :fax, {type: "tel", class: "form-control" } %>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 form-group">
              <%= profile_form.label :notes %>
              <%= profile_form.text_area :notes, {class: "form-control"} %>
            </div>
          </div>
        <% end %>
      </fieldset>
    </div>
  </div>

  <% if policy(user).assign_to_role? %>
    <div class="row">
      <div class="col-md-12">
        <fieldset>
          <legend>Role and Access</legend>
          <div class="row">
            <div class="col-md-4 form-group">
              <%= form.label "Role" %>
              <%= form.select :role_id, roles_for_select(user: @user, editor: current_user, value: @user.role_id),{}, { class: "form-control" }%>
            </div>
          </div>
        </fieldset>
      </div>
    </div>
  <% end %>

  <% unless @user.new_record? %>
  <div class="row">
    <div class="col-md-12">
      <fieldset>
        <legend>Property Assignments</legend>
        <%= render partial: "property_assignments", locals: {user: @user} %>
      </fieldset>
    </div>
  </div>
  <% end %>

  <div class="form-group">
    <button type="submit" class="btn btn-primary">Submit</button>
    <%= link_to 'Back', ( policy(User).index? ? users_path : :back ), class: "btn btn-xs btn-info" %>
  </div>
<% end %>

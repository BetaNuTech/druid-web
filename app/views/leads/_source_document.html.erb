<div class="source-email-section">
  <div class="section-header">
    <h2><%= glyph(:envelope) %> Source Email</h2>
    <button type="button" 
            class="btn btn-primary" 
            data-toggle="collapse" 
            data-target="#lead_source_document" 
            aria-expanded="false" 
            aria-controls="lead_source_document">
      <span class="toggle-text">Show</span>
      <%= glyph(:chevron_down) %>
    </button>
  </div>
</div>
<div class="collapse" id="lead_source_document">
  <div class="source-email-container">
    <div class="email-preview-container">
      <% if lead.source_document[:html].present? %>
        <div class="email-preview-wrapper">
          <h5>HTML Version</h5>
          <iframe class="email-preview-frame" 
                  srcdoc="<%= lead.source_document[:html] %>">
          </iframe>
        </div>
      <% end %>
      
      <% if lead.source_document[:text].present? %>
        <div class="email-preview-wrapper">
          <h5>Text Version</h5>
          <iframe class="email-preview-frame" 
                  srcdoc="<pre><%= h(lead.source_document[:text]) %></pre>">
          </iframe>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  // Toggle button text and chevron on collapse
  $('#lead_source_document').on('shown.bs.collapse', function () {
    var button = $('[data-target="#lead_source_document"]');
    button.find('.toggle-text').text('Hide');
    button.find('.glyphicon').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
    button.attr('aria-expanded', 'true');
  });
  
  $('#lead_source_document').on('hidden.bs.collapse', function () {
    var button = $('[data-target="#lead_source_document"]');
    button.find('.toggle-text').text('Show');
    button.find('.glyphicon').removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
    button.attr('aria-expanded', 'false');
  });
</script>
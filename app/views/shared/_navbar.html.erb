<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed"
        data-toggle="collapse" data-target="#navbar"
        aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="navbar-brand" href="/"> <span class="glyphicon glyphicon-tree-deciduous" /> </a>
        <a class="navbar-brand" href="/"> Druid LM</a>
      </div>

      <div id="navbar" class="collapse navbar-collapse ">
        <ul class="nav navbar-nav">
          <% if current_user.present? %>
            <li> <!-- Leads -->
              <div class="btn-group">
                <%= link_to(leads_path, class: "btn #{nav_active_class(leads_path)}") do %>
                  <span class="glyphicon glyphicon-flag"></span> Leads
                <% end %>
                <button type="button" class="btn dropdown-toggle <%= nav_active_dropdown_class(leads_path) %>" data-toggle="dropdown">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                    <%= link_to(leads_path(lead_search: {user_ids: [current_user.id]})) do %>
                      <span class="glyphicon glyphicon-star"></span> My Leads
                    <% end %>
                  </li>
                  <li role="separator" class="divider"></li>
                  <li>
                    <%= link_to(leads_path(lead_search: {priorities: [ 'urgent' ]})) do %>
                      <span class="glyphicon glyphicon-warning-sign"></span> Urgent Leads
                    <% end %>
                  </li>
                  <li>
                    <%= link_to(leads_path(lead_search: {states: ['open']})) do %>
                      <span class="glyphicon glyphicon-envelope"></span> Unclaimed Leads
                    <% end %>
                  </li>
                  <li>
                    <%= link_to(leads_path(lead_search: {states: ['claimed']})) do %>
                      <span class="glyphicon glyphicon-flag"></span> Claimed Leads
                    <% end %>
                  </li>
                  <li>
                    <%= link_to(leads_path(lead_search: {states: ['converted']})) do %>
                      <span class="glyphicon glyphicon-check"></span> Closed Leads
                    <% end %>
                  </li>
                  <li role="separator" class="divider"></li>
                  <li>
                    <%= link_to(new_lead_path) do %>
                      <span class="glyphicon glyphicon-pencil"></span> Create Lead
                    <% end %>
                  </li>
                </ul>
              </div>
            </li> <!-- Leads -->

            <li> <!-- Messaging -->
              <div class="btn-group">
                <a href="#" class="btn btn-info"><span class="glyphicon glyphicon-envelope"></span> Messaging</a>
                <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                  <li><a href="#"><span class="glyphicon glyphicon-star"></span> Unresponded Emails</a></li>
                  <li><a href="#"><span class="glyphicon glyphicon-list-alt"></span> Recent Emails</a></li>
                  <li><a href="#"><span class="glyphicon glyphicon-send"></span> Create Email</a></li>
                  <li><a href="#"><span class="glyphicon glyphicon-th"></span> Email Templates</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a href="#"><span class="glyphicon glyphicon-calendar"></span> Reminders</a></li>
                  <li><a href="#"><span class="glyphicon glyphicon-bell"></span> Create Reminder</a></li>
                  <li role="separator" class="divider"></li>
                </ul>
              </div>
            </li> <!-- Messaging -->

            <li> <!-- Reports -->
              <div class="btn-group">
                <a href="#" class="btn btn-info"><span class="glyphicon glyphicon-stats"></span> Reports</a>
                <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                  <li><a href="#"><span class="glyphicon glyphicon-picture"></span> Report 1</a></li>
                  <li><a href="#"><span class="glyphicon glyphicon-tasks"></span> Report 2</a></li>
                </ul>
              </div>
            </li> <!-- Properties -->

            <% if policy(Property).index? %>
            <li> <!-- Properties -->
              <div class="btn-group">
                <%= link_to(properties_path, class: "btn #{nav_active_class(properties_path)}") do %>
                  <span class="glyphicon glyphicon-home"></span> Properties
                <% end %>
                <button type="button" class="btn dropdown-toggle <%= nav_active_dropdown_class(properties_path)%>" data-toggle="dropdown">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                    <%= link_to(properties_path) do %>
                      <span class="glyphicon glyphicon-home"></span> Manage Properties
                    <% end %>
                  </li>
                  <% if current_user.admin? %>
                  <li><a href="#"><span class="glyphicon glyphicon-user"></span> Manage Property Residents</a></li>
                  <% end %>
                </ul>
              </div>
            </li> <!-- Properties -->
            <% end %>

            <% if current_user.admin? %>
            <li> <!-- System -->
              <div class="btn-group">
                <a  href="#" class="btn btn-info"><span class="glyphicon glyphicon-wrench"></span> System</a>
                <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                  <% if policy(User).index? %>
                  <li>
                    <%= link_to(users_path) do %>
                      <span class="glyphicon glyphicon-user"></span> Manage Druid Users
                    <% end %>
                  </li>
                  <% end %>
                  <% if policy(Role).index? %>
                  <li>
                    <%= link_to(roles_path) do %>
                      <span class="glyphicon glyphicon-cog"></span> Manage User Roles
                    <% end %>
                  </li>
                  <% end %>
                  <% if policy(LeadSource).index? %>
                  <li>
                    <%= link_to(lead_sources_path) do %>
                      <span class="glyphicon glyphicon-download-alt"></span> Lead Sources
                    <% end %>
                  </li>
                  <% end %>
                  <% if current_user.admin? %>
                  <li><a href="#"><span class="glyphicon glyphicon-wrench"></span> Lead Management Settings</a></li>
                  <li><a href="#"><span class="glyphicon glyphicon-wrench"></span> System Configuration</a></li>
                  <% end %>
                </ul>
              </div>
            </li> <!-- System -->
          <% end %>

          <% end %>
          <li> <!-- Account -->
            <div class="btn-group">
              <% if current_user.present? %>
                <%= link_to(destroy_user_session_path, method: :delete, class: "btn btn-info") do %>
                  <span class="glyphicon glyphicon-off"></span> Logout
                <% end %>
                <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                    <%= link_to(edit_user_path(current_user)) do %>
                      <span class="glyphicon glyphicon-user"></span> My Account
                    <% end %>
                  </li>
                </ul>
              <% else %>
                <%= link_to(new_user_session_path, class: "btn btn-info") do %>
                  <span class="glyphicon glyphicon-off"></span> Login
                <% end %>
              <% end %>
            </div>
          </li> <!-- Properties -->
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>
